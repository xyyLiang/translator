    /**
     * Fills the input buffer, taking the mark into account if it is valid.
     */